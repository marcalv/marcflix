<!doctype html>
<html lang="en">
 
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarcFlix</title>

    <!-- jQuery -->
    <script src="/static/libs/jquery-3.4.1.min.js"></script>

    <!-- Bootstrap -->
    <link rel="stylesheet" type="text/css" href="/static/libs/bootstrap-4.3.1.min.css">

    <link rel="stylesheet" type="text/css" href="/static/css/style.css">

</head>
 
<body>
    <div class="container mt-4">
        <img src="/static/images/brandname.png" class="mx-auto d-block mb-4" style="max-width: 300px;" alt="Responsive image">

        <div class="my-4 form-inline">
                <label for="magnet">Mantener despierto</label>
                <a id="statuson" class="btn btn-success mx-sm-3" href="/api/alive/on">Activar</a>
                <a id="statusoff" class="btn btn-danger mx-sm-3" href="/api/alive/off">Desactivar</a>
                <a id="loading" class="btn btn-secondary mx-sm-3" href="#">Cargando</a>
        </div>

        <form class="form-inline mt-4" action="/api/add" method="post">
            <div class="form-group mb-2">
                <label for="magnet">Enlace magnet:</label>
            </div>
            <div class="form-group mx-sm-3 mb-2">
                <input type="text" class="form-control" id="magnet" name="magnet">
            </div>
            <div class="form-group mb-2">
                <button class="btn btn-primary" type="submit" value="Submit">AÃ±adir</button>
            </div>
        </form> 
    
        <h3 class="mt-4">Torrents</h3>
        <ul class="" id="torrentdiv">
            <!-- CONTENT -->
        </ul>

        <h3>Descargar</h3>
        <ul class="" id="filedownload">
                <!-- CONTENT -->
        </ul>

        <h3>Ver en Android</h3>
        <ul class="" id="filediv">
                <!-- CONTENT -->
        </ul>

        <h3>Ver en iPhone</h3>
        <ul class="" id="filedivios">
                <!-- CONTENT -->
        </ul>
    </div>

    

    
        <div class="myfooter mt-5">
            <p>Necesitas tener instalada la app VLC ðŸ‘‡ </p>
            <div class="row">
                    <div class="col-6">
                            <a href="https://play.google.com/store/apps/details?id=org.videolan.vlc"><img src="/static/images/vlc_android2.png" class="img-fluid" ></a>

                    </div>
                    <div class="col-6">
                            <a href="https://itunes.apple.com/app/apple-store/id650377962?pt=454758&amp;ct=vodownloadpage&amp;mt=8"><img src="/static/images/vlc_ios2.png" class="img-fluid" style="max-height:5px;"></a>
                        </div>
                  </div>
        </div>
      
     
      
    


</body>


<style>
.myfooter {
  
  padding: 1rem;
  background-color: #efefef;
  text-align: center;

}
img {
    max-height: 201px !important;
    width: auto;
}

</style>


<script>
    const TorrentItem = ({ torrent }) => `
    <li id="${torrent.infoHash}" class="">
            ${torrent.progress}% - ${torrent.downloadSpeed}/s  - ${torrent.name} 
    </li>
`;

const FileItemAndroid = ({ file }) => `
    <li class="">
            <a href=intent://${file.url.replace("http://","").replace("https://","")}#Intent;scheme=http;type=video/*;end ">${file.name}</a>
    </li>
`;

const FileItemIos = ({ file }) => `
    <li class="">
            <a href="vlc-x-callback://x-callback-url/stream?url=${file.url}">${file.name}</a>
    </li>
`;

const FileItemDownload = ({ file }) => `
    <li class="">
            <a href="${file.url}">${file.name}</a>
    </li>
`;

updateinfo()
window.setInterval(function () {
    updateinfo()
  }, 3000);


$("#statusoff").hide()
$("#statuson").hide()
uptimestatus()
function uptimestatus(){
    $.getJSON('/api/uptimestatus', function(data){
        status = data;
        
        if (status == '0'){
            $("#statuson").show()
            $("#statusoff").hide()
        }else{
            $("#statuson").hide()
            $("#statusoff").show()
        }
        $("#loading").hide()
        
    })
   
}

function updateinfo(){
      
      
      
      
    $.getJSON('/api/info', function(data){
                    console.log('Received data')
                    console.log(data)

                    

                    //Add items to sourceBlock
                    $("#torrentdiv").empty();
                    data.torrentsInfo.forEach((torrent)=>{
                        console.log(torrent.name)
                        itemBlock = TorrentItem({ torrent: torrent})
                        $('#torrentdiv').append(itemBlock)
                    });

                    $("#filediv").empty();
                    data.links.forEach((file)=>{
                        console.log(file.name)
                        itemBlock = FileItemAndroid({ file: file})
                        $('#filediv').append(itemBlock)
                    });
                    
                    $("#filedivios").empty();
                    data.links.forEach((file)=>{
                        console.log(file.name)
                        itemBlock = FileItemIos({ file: file})
                        $('#filedivios').append(itemBlock)
                    });
                    
                    $("#filedownload").empty();
                    data.links.forEach((file)=>{
                        console.log(file.name)
                        itemBlock = FileItemDownload({ file: file})
                        $('#filedownload').append(itemBlock)
                    });
                    
                 });

  }




    
</script>
 
</html>